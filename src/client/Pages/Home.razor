@page "/"

@inject NavigationManager NavigationManager
@inject ScrollService ScrollService
@inject IHttpClientFactory HttpClientFactory
@inject ISnackbar Snackbar

<MudContainer Style="background-color: #f0f7ff;" Class="pt-14 pb-14 pl-10 pr-10 home-root-container" MaxWidth="MaxWidth.False">
	<MudChip T="string"
			 Size="Size.Small"
			 Style="background-color: #dcfce7; color: #016630; font-size: 0.75rem;"
			 Variant="Variant.Filled" Class="mb-2">
		@((MarkupString)CustomIcons.Gift)
		<span class="ml-2">100% Pulsuz resurslar</span>
	</MudChip>

	<MudText Align="Align.Center"
			 Style="font-weight:600; font-size:clamp(1.75rem, 5vw, 2.5rem); line-height:1.2;">
		Sıfırdan
		<span style="color: var(--mud-palette-primary);">Qazax dili</span>
		öyrən B1 səviyyəsinədək
	</MudText>

	<!-- Subtitle -->
	<div style="display: flex; justify-content: center;">
		<MudText Typo="Typo.body2"
				 Style="max-width:700px; width:100%; font-size:clamp(1rem, 2.5vw, 1.25rem); color:#4a5565;"
				 Class="mt-2 mb-6"
				 Align="Align.Center">
			Mənim şəxsi öyrənmə yolum. Tam yol xəritəsi, söz bazası və materiallar -
			3 ay ərzində B1 səviyyəsinə çatmaq üçün, tamamilə pulsuz.
		</MudText>
	</div>

	<!-- CTA Buttons -->
	<MudStack Justify="Justify.Center" Row Class="my-10">
		<MudButton Variant="Variant.Filled"
				   OnClick="@(()=> ScrollService.ScrollToJourney())"
				   Color="Color.Dark"
				   Size="Size.Medium"
				   StartIcon="@CustomIcons.Map">
			3 aylıq yol xəritəsinə bax
		</MudButton>

		<MudButton Href="/vocabulary"
				   Variant="Variant.Filled"
				   Size="Size.Medium"
				   Color="Color.Surface"
				   StartIcon="@CustomIcons.Vocabulary">
			Söz bazasına keç
		</MudButton>
	</MudStack>

	<!-- Stats -->
	<MudGrid Justify="Justify.Center">
		<MudItem xs="12" sm="6" md="4">
			<MudText Align="Align.Center" Typo="Typo.h3" Color="Color.Primary" Style="font-weight:700;">1500+</MudText>
			<MudText Align="Align.Center" Typo="Typo.body2" Style="font-weight:300;">Söz bazası</MudText>
		</MudItem>

		<MudItem xs="12" sm="6" md="4">
			<MudText Align="Align.Center" Typo="Typo.h3" Color="Color.Primary" Style="font-weight:700;">100%</MudText>
			<MudText Align="Align.Center" Typo="Typo.body2" Style="font-weight:300;">Pulsuz məzmun</MudText>
		</MudItem>

		<MudItem xs="12" sm="6" md="4">
			<MudText Align="Align.Center" Typo="Typo.h3" Color="Color.Primary" Style="font-weight:700;">3 ay</MudText>
			<MudText Align="Align.Center" Typo="Typo.body2" Style="font-weight:300;">B1 səviyyəsinə çatmaq</MudText>
		</MudItem>
	</MudGrid>
</MudContainer>

<MudContainer Style="background-color: #f9fafb;" Class="pa-10 home-root-container" MaxWidth="MaxWidth.False">
	<MudText Typo="Typo.h4" Align="Align.Center" Style="font-weight:600;">
		Burada nə tapacaqsınız
	</MudText>

	<!-- Subtitle -->
	<div style="display: flex; justify-content: center;">
		<MudText Typo="Typo.body2" Align="Align.Center" Style="font-size: 1rem; color: #4a5565;" Class="mt-2 mb-6">
			B1 səviyyəsinə gedən yolda öyrəndiklərim
		</MudText>
	</div>

	<MudGrid Class="mt-2 mb-2">
		@foreach (var card in _cards)
		{
			<CustomCardComplex Title="@card.Title"
							   Content="@card.Content"
							   Icon="@card.Icon" />
		}
	</MudGrid>
</MudContainer>

<MudContainer Class="pa-10 mb-4 home-root-container" MaxWidth="MaxWidth.False">
	<div style="display: flex; justify-content: center;">
		<MudPaper Class="left-border-primary pa-4" Width="90%" Style="display: flex; align-items: flex-start;">
			<MudIcon Color="Color.Primary" Size="Size.Medium" Icon="@CustomIcons.Person"
					 Class="mr-4" />

			<MudStack Spacing="1" Row="false" Class="flex-grow">
				<MudText Typo="Typo.h6" Class="mb-2" Style="font-weight: 600; color: var(--mud-palette-text-primary);">
					Şəxsi öyrənmə yolum
				</MudText>

				<MudText Typo="Typo.caption" Color="Color.Dark" Class="mb-2" Style="font-weight: 350; font-size: 1rem;">
					Bu kommersiya kursu deyil – qazax dilini öyrənmə yolumu
					pulsuz şəkildə hər kəs ilə paylaşıram. Hər bir söz,
					qayda və məsləhət sıfırdan B1-ə qədərki real təcrübəmdən gəlir.
				</MudText>

				<MudText Typo="Typo.caption" Color="Color.Dark" Style="font-weight: 350; font-size: 1rem;">
					Məncə dil öyrənmək üçün resurslar hamı üçün əlçatan olmalıdır.
					Buna görə burada hər şey tamamilə pulsuzdur və elə də qalacaq.
				</MudText>
			</MudStack>
		</MudPaper>
	</div>
</MudContainer>

@if (_vocabularyStatsDto != null && _vocabularyStatsDto.Categories.Any())
{
	var vocabularies = _vocabularyStatsDto.Categories;

	<MudContainer Style="background-color: #f6faff;" Class="pa-10" MaxWidth="MaxWidth.False">
		<MudText Typo="Typo.h4" Align="Align.Center" Style="font-weight:600;">
			@_vocabularyStatsDto.TotalWords sözü kateqoriyalara görə araşdırın
		</MudText>

		<!-- Subtitle -->
		<div style="display: flex; justify-content: center;">
			<MudText Typo="Typo.body2" Align="Align.Center" Style="font-size: 1rem; color: #4a5565;" Class="mt-2 mb-6">
				Kateqoriyalara görə təşkil olunmuş siyahılarla qazax dilində söz bazanızı genişləndirin
			</MudText>
		</div>

		<MudGrid Class="mt-2 mb-2">
			@foreach (var keyValuePair in vocabularies)
			{
				<CustomCardSimple Content="@keyValuePair.Key"
								  Count="@keyValuePair.Value"
								  OnClick="@(()=> NavigationManager.NavigateTo($"/vocabulary/{keyValuePair.Key}"))" />
			}
		</MudGrid>
	</MudContainer>
}

<MudContainer id="ThreeMonthJourney" Class="pt-10 home-root-container mb-5" MaxWidth="MaxWidth.False">
	<MudText Typo="Typo.h4" Align="Align.Center" Color="Color.Dark" Style="font-weight:600;">
		3 aylıq öyrənmə planı
	</MudText>

	<!-- Subtitle -->
	<div style="display: flex; justify-content: center;">
		<MudText Typo="Typo.body2" Color="Color.Dark" Align="Align.Center" Style="font-size: 1rem; " Class="mt-2 mb-6">
			Məni B1 səviyyəsinə aparan həmin yol
		</MudText>
	</div>

	<MudTimeline>
		<MudTimelineItem Color="Color.Primary" Size="Size.Small">
			<ItemOpposite>
				<MudText Typo="Typo.h5">1-ci ay: Bünövrə (800 söz)</MudText>
			</ItemOpposite>

			<ItemContent>
				<MudStack Row="false">
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							1-ci həftə:
						</MudText>
						42 hərfli əlifbanı və xüsusi səsləri öyrənmək
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							2-ci həftə:
						</MudText>
						Şəxsi əvəzliklər və "болу" (olmaq) feilinin istifadəsi
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							3-cü həftə:
						</MudText>
						1–20 rəqəmləri, vaxt ifadələri və həftənin günləri
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							4-cü həftə:
						</MudText>
						Ailə üzvləri və əsas söz bazası
					</MudText>
				</MudStack>
			</ItemContent>
		</MudTimelineItem>

		<MudTimelineItem Size="Size.Small">
			<ItemOpposite>
				<MudText Typo="Typo.h5">2-ci ay: Qrammatika və hallanma (1000 söz)</MudText>
			</ItemOpposite>

			<ItemContent>
				<MudStack Row="false">
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							5-ci həftə:
						</MudText>
						Keçmiş zaman (-ды/-ді və -ған/-ген şəkilçiləri ilə)
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							6-cı həftə:
						</MudText>
						Gələcək zaman quruluşları
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							7–8-ci həftələr:
						</MudText>
						Hal sistemi (Yönlük, Çıxışlıq, Yerlik) praktik nümunələrlə
					</MudText>
				</MudStack>
			</ItemContent>
		</MudTimelineItem>

		<MudTimelineItem Size="Size.Small">
			<ItemOpposite>
				<MudText Typo="Typo.h5">3-cü ay: Axıcılıq və təcrübə (1500+ söz)</MudText>
			</ItemOpposite>

			<ItemContent>
				<MudStack Row="false">
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							9-cu həftə:
						</MudText>
						Şərt və səbəb əlaqələri
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							10-cu həftə:
						</MudText>
						Bağlayıcılar və mürəkkəb cümlələr
					</MudText>
					<MudText Typo="Typo.body2" Style="font-weight:400;">
						<MudText Typo="Typo.body2" Style="font-weight:600;" Inline>
							11–12-ci həftələr:
						</MudText>
						Xəbərlər, söhbətlər və yazı ilə intensiv məşq
					</MudText>
				</MudStack>
			</ItemContent>
		</MudTimelineItem>
	</MudTimeline>
</MudContainer>

@code {
	private HttpClient? _httpClient;
	private VocabularyStatsDto? _vocabularyStatsDto;

	private readonly List<CardItem> _cards = new()
	{
		new CardItem { Title = "Tam əlifba", Content = "Bütün 42 hərf və tələffüz qaydaları, digər dillərdə olmayan xüsusi səslərlə birlikdə", Icon = CustomIcons.Pen },
		new CardItem { Title = "Quruluşlu qrammatika", Content = "Əsas qaydalar, feil şəkilləri, hallanma və cümlə quruluşları nümunələrlə", Icon = CustomIcons.BookOpen },
		new CardItem { Title = "Kateqoriyalara görə söz bazası", Content = "Heyvanlar, ailə, yemək, rənglər və daha çox mövzular üzrə tərtib edilmiş siyahılar", Icon = CustomIcons.Audio2 },
		new CardItem { Title = "3 aylıq yol xəritəsi", Content = "Həftə-həftə plan: sıfırdan B1 ünsiyyət səviyyəsinədək", Icon = CustomIcons.Time },
		new CardItem { Title = "Şəxsi təcrübə", Content = "Real tövsiyələr, edilən səhvlər və öz təcrübəmdən məsləhətlər", Icon = CustomIcons.Heart },
		new CardItem { Title = "İstinad", Content = "Gündəlik söhbətlər üçün ifadələr, söz birləşmələri və ən vacib sözlər", Icon = CustomIcons.QuickRef }
	};

	protected override async Task OnInitializedAsync()
	{
		// Presence.ActiveCountChanged += (int count) =>
		// {
		//     _activeUsersCount = count;
		//     InvokeAsync(StateHasChanged);
		// };

		// await Presence.StartAsync();

		try
		{
			_httpClient ??= HttpClientFactory.CreateClient("LearnKazakhApi");
			var response = await _httpClient.GetFromJsonAsync<ApiResponse<VocabularyStatsDto>>("vocabulary/stats");

			if (response?.Success == true && response.Data is VocabularyStatsDto vocabularyStatsDto)
			{
				_vocabularyStatsDto = vocabularyStatsDto;
			}
		}
		catch (Exception)
		{
			Snackbar.Add("Failed to load vocabulary statistics.", Severity.Error);
		}
	}

	private class CardItem
	{
		public string Title { get; set; } = string.Empty;
		public string Content { get; set; } = string.Empty;
		public string Icon { get; set; } = string.Empty;
	}
}

<style>
	.mud-chip-container {
		display: flex;
		justify-content: center;
	}

	.left-border-primary {
		border-left: 4px solid var(--mud-palette-primary);
	}
</style>